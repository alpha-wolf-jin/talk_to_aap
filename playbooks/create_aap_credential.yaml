---
- name: Create Credential in AAP (Simple Version)
  hosts: localhost
  connection: local
  gather_facts: false
  
  vars:
    # Controller connection details
    controller_hostname: "https://192.168.122.20"
    controller_oauthtoken: "EIFnMuewWUVded037eBSNuX4lJlUBX"
    controller_validate_certs: false

    # Credential details
    credential_name: "My Machine Credential"
    credential_description: "Machine credential for SSH access"
    credential_organization: "MyOrganization"
    credential_type: "Machine"
    
  tasks:
    - name: Create Machine credential in AAP
      ansible.controller.credential:
        controller_host: "{{ controller_hostname }}"
        controller_oauthtoken: "{{ controller_oauthtoken }}"
        validate_certs: "{{ controller_validate_certs }}"
        name: "{{ credential_name }}"
        description: "{{ (credential_description | default('') | length > 0) | ternary(credential_description, omit) }}"
        organization: "{{ (credential_organization | default('') | length > 0) | ternary(credential_organization, omit) }}"
        credential_type: "{{ credential_type }}"
        state: present
      register: credential_result
      no_log: false  # Hide sensitive data in logs
    
    - name: Confirm credential was created
      debug:
        msg: "Credential '{{ credential_name }}' has been successfully created/updated!"
      when: credential_result is changed or credential_result is succeeded

